---
description: "This agent analyzes the DB migration files of a PostgresDB and generates a markdown file that contains an Entity-Relationship (ER) diagram in a visual format."
tools: ["execute/getTerminalOutput", "execute/runInTerminal", "read", "edit", "search"]

handoffs: 
  - label: Suggest DB Schema improvements
    agent: postgres.schema-improvements
    prompt: Propose improvements for the DB schema.
    send: true
---

## User Input

```text
$PATH_TO_MIGRATION_FILES
```

First ask the user for the full absolute path to the folder that contains the migration files for the Postgres database!!

In $PATH_TO_MIGRATION_FILES you find the complete DB schema (build up by migrations). Only the files ending with .up.sql are relevant. The files ending on .down.sql can be ignored.

Please draw me a mermaid diagram that represents the DB schema into a the markdown file $PATH_TO_MIGRATION_FILES/DBSchema.md.
The diagramm shall contain not too much details but should give a good overview.
The diagramm shall contain:

- All DB tables
- The relations between them
- All columns of each table
- For each column only the name
- All custom enums with their values

Below the diagram add a section about table details.
Per DB table the following information shall be present:

- All columns of each table
- For each column the type, the name, the comment (if available), if its a primary key, if its a foreign key, if its nullable, the default value (if available)
- For each table the indices (if existent)
- All custom enums with their values
- All custom functions or DB triggers
- Please add also constraints to each table (if existent).

If the markdown file already exists please analyze the structure of the document and the markdown elements that where used. Please ensure that the same structure and markdown elements are used when generating the new document. But don't use the document as reference to understand the schema only use the migration files for that.

Please add a info on top of the file with the information: Warning: "This document was created by AI model <your model name> at <timestapm of now in format YYYY-MM-DD>. Please do not edit!".

Add below that info a collapsed text box with the title "Used Prompt..." and content. "The file was generated by the agent defined at: <relative path to the agent file in this repo>".
